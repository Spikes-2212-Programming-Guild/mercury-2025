<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mercury 2025</title>
</head>
<body>

<div id="top_absolute_navigation"></div>

<div id="questions"></div>

<div id="relative_navigation">
    <button id="prev_button">Previous</button>
    <button id="next_button">Next</button>
</div>

<div id="bottom_absolute_navigation"></div>

</body>

<script>
    class Question {

        constructor(id, title) {
            this.id = id;
            this.title = title;
        }

        getElement() {}
    }

    class TextQuestion extends Question {

        static type = 'text'

        constructor(id, title) {
            super(id, title);
        }

        getElement() {
            const docTitle = document.createElement('label');
            docTitle.innerHTML = this.title;
            const input = document.createElement('input');
            input.setAttribute('type', 'text');
            input.setAttribute('class', 'question');
            input.setAttribute('id', this.id);
            input.style.outline = '2px solid black';
            docTitle.appendChild(input);
            return docTitle;
        }
    }

    class MultipleChoiceQuestion extends Question {

        static type = 'choices'

        constructor(id, title, choices) {
            super(id, title);
            this.choices = choices;
        }

        getElement() {
            const docTitle = document.createElement('label');
            docTitle.innerHTML = this.title;
            // Create the select element
            const select = document.createElement('select');
            select.setAttribute('id', this.id);
            select.setAttribute('class', 'question');
            select.style.outline = '2px solid black';

            // Add the default "Choose" option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Choose';
            select.appendChild(defaultOption);

            // Add options from this.choices
            for (let choice of this.choices) {
                const option = document.createElement('option');
                option.value = choice;
                option.textContent = choice;
                select.appendChild(option);
            }
            docTitle.appendChild(select);
            return docTitle;
        }
    }

    class NumberQuestion extends Question {

        static type = 'number'

        constructor(id, title) {
            super(id, title);
        }

        getElement() {
            const docTitle = document.createElement('label');
            docTitle.innerHTML = this.title;
            const input = document.createElement('input');
            input.setAttribute('type', 'number');
            input.setAttribute('class', 'question');
            input.setAttribute('id', this.id);
            input.style.outline = '2px solid black';
            docTitle.appendChild(input);
            return docTitle;
        }
    }

    const json = {
        "Pages": [
            {
                "name": "Pre-Game",
                "questions": [
                    {"id": "scouter_name", "title": "Enter scouter name", "type": TextQuestion.type},
                    {"id": "alliance", "title": "Enter the alliance", "choices": ["blue", "red"], "type": MultipleChoiceQuestion.type}
                ]
            },
            {
                "name": "Autonomous",
                "questions": [
                    {"id": "team_number", "title": "Enter team number", choices: [2212, 1690, 5554], "type": MultipleChoiceQuestion.type},
                ]
            },
            {
                "name": "End-Game",
                "questions": [
                    {"id": "score", "title": "Enter score", "type": NumberQuestion.type},
                ]
            },
        ]
    }

    async function submit() {
        const formData = {};
        Object.keys(localStorage).forEach(key => {
            formData[key] = localStorage.getItem(key);
        });
        console.log(formData);

        try {
            Object.keys(localStorage).forEach(key => {
                localStorage.removeItem(key);
            });

            const response = await fetch("http://localhost:3000/submit", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(formData),
            });

            if (response.ok) {
                alert("Form data inserted successfully");
                window.location.href='${pages[0].name}'
            } else {
                alert("Error inserting form data");
            }
        } catch (error) {
            console.error("Error:", error);
            alert("Error inserting form data");
        }
    }

    function renderAbsoluteNavigationButtons(container) {
        pages.forEach(page => {
            const button = document.createElement('button');
            button.innerHTML = page.name;
            button.addEventListener('click', () => displayPage(page.name));
            container.appendChild(button);
        });
    }

    function displayPage(pageName) {
        for (const page of document.getElementsByClassName('page')) {
            page.style.display = page.id === pageName ? 'block' : 'none';
        }

        currentPage = pages.find(page => page.name === pageName);
        updateRelativeNavigationButtons();
    }

    function updateRelativeNavigationButtons() {
        const pageIndex = pages.indexOf(currentPage);
        let nextButton = config.relativeNavigationButtons.next;
        let prevButton = config.relativeNavigationButtons.prev;

        prevButton.style.visibility = pageIndex > 0 ? 'visible' : 'hidden';
        prevButton.onclick = pageIndex > 0 ? () => displayPage(pages[pageIndex - 1].name) : null;

        nextButton.style.visibility = pageIndex + 1 < pages.length ? 'visible' : 'hidden';
        nextButton.onclick = pageIndex + 1 < pages.length ? () => displayPage(pages[pageIndex + 1].name) : null;
    }

    function createAllQuestions() {
        pages.forEach(page => {
            questions[page.name] = {};
            const pageDiv = document.createElement('fieldset');
            pageDiv.classList.add('page');
            pageDiv.id = page.name;

            page.questions.forEach(question => {
                const questionInstance = createQuestion(question);
                questions[page.name][question.id] = questionInstance;
                pageDiv.appendChild(questionInstance.getElement());
            });

            config.questionContainer.appendChild(pageDiv);
        });
    }

    function createQuestion(question) {
        switch (question.type) {
            case TextQuestion.type:
                return new TextQuestion(question.id, question.title);
            case NumberQuestion.type:
                return new NumberQuestion(question.id, question.title);
            case MultipleChoiceQuestion.type:
                return new MultipleChoiceQuestion(question.id, question.title, question.choices);
        }
    }

    function initializeApp(config) {
        createAllQuestions();
        renderAbsoluteNavigationButtons(config.absoluteNavContainers.top);
        renderAbsoluteNavigationButtons(config.absoluteNavContainers.bottom);
        updateRelativeNavigationButtons();
        displayPage(currentPage.name);
    }

    // global variables
    const config = {
        questionContainer: document.getElementById('questions'),
        absoluteNavContainers: {
            top: document.getElementById('top_absolute_navigation'),
            bottom: document.getElementById('bottom_absolute_navigation')
        },
        relativeNavigationButtons: {
            prev: document.getElementById('prev_button'),
            next: document.getElementById('next_button'),
        }
    };

    const pages = json.Pages;
    const questions = {};
    let currentPage = pages[0];

    initializeApp(config);

</script>
</html>